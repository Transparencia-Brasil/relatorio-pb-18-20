---
title: "DadosJus"
output:
  prettydoc::html_pretty:
    theme: cayman
    css: '/home/david/mppb/entrega-relatorio/dadosjus/stylesheets/prettydoc-cayman.css'
    highlight: github
    df_print: paged
    
---

```{r  echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
library(here)
library(tidyverse)
dados = read_csv(here("dados/employees.csv"))

dados_filtrados <- dados %>% 
          filter(income_total > 0 & wage > 0 & perks_total > 0 & others_total > 0)
```

A lei de número 12.527, também conhecida como lei da transparência, foi criada em 18 de novembro de 2011. Essa lei tem como objetivo principal exigir que os órgãos integrantes da administração direta dos poderes Executivo, Legislativo, e Judiciário disponibilizem seus dados financeiros de forma pública e acessível para toda a população brasileira.
Hoje todos os tribunais e ministérios públicos disponibilizam mensalmente em seus sites informações detalhada sobre seus gastos. Uma parte importante desses gastos são as remunerações dos trabalhadores e trabalhadoras desses órgãos.

Apesar dos dados estarem disponíveis ainda é difícil ter um controle social sobre os gastos de remunerações. Isso ocorre pois, os dados se encontram em diversos formatos de arquivos (.pdf, .ods, .xls, .csv, .html…) e frequentemente estão estruturados em formas diferentes, além de estarem espalhados em diversos sites e plataformas.

O DadosJus tem como objetivo realizar o processo de libertação dos dados de gastos com remunerações do poder judiciário e dos ministérios públicos do Brasil. 

# Sobre os dados
As remunerações¹ incluem valores que vão além do salário². Os conhecidos auxílios ou indenizações, são gastos eventuais que podem constituir as remunerações. Auxílios como alimentação, pré escolar, saúde, natalidade, moradia e ajuda de custo, são exemplos de indenizações que podem ser recebidas por funcionários dos tribunais e ministérios públicos do Brasil

¹Remuneração: é a soma do salário mais outras vantagens (indenizações e auxílios). 

²Salário: valor recebido de acordo com a prestação de serviços, em decorrência do contrato de trabalho.

# Paraíba

No estado da Paraíba temos três tribunais. São eles: Tribunal de Justiça da Paraíba (TJPB), Tribunal Regional Eleitoral da Paraíba (TRE) e Tribunal Regional do Trabalho 13º Região (TRT13). Ainda temos o Ministério Público da Paraíba (MPPB). 
No mês mais recente que temos dados disponíveis (outubro) o TRE apresentava um total de **801** funcionários e o no TRT13 são **1544**.

### São cerca de XXXX funcionários nos 4 órgãos paraibanos

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
dados %>% 
  filter(year == 2019) %>% 
  filter(month == 10) %>% 
  group_by(aid) %>% 
  count() %>% 
  ggplot(aes(x=aid, y=n, fill=aid)) +
  geom_bar(stat="identity")+theme_minimal() + scale_fill_brewer(palette = "Set2") + xlab("Órgão") + ylab("Total de funcionários") + labs(fill = "Tribunal", title = "Total de funcionários em cada tribunal em Out de 2019" ) +
  scale_fill_brewer(palette = "Set2") 
```

## TRT13
O TRT13 atualmente tem um total de 1544 funcionários. A remuneração mediana no ano de 2019 foi de 18.525,00 R\$. Enquanto a máxima foi de 370.604,00 R\$ e o mínimo de 2.317,00 R\$.
No ano de 2018 tivemos uma remuneração mediana de 17.717,00 R\$. Enquanto a máxima é de 168.570.040,00 R\$ e o mínimo de 2.139,00 R\$.

### Servidores são maioria no TRT13 e quantidade de pensionista e servidores é quase igual
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
# load library
library(ggplot2)

# Create test data.
data <- data.frame(
  category=c("Membro", "Pensionista", "Servidor"),
  count=c(98, 107, 1339)
)
 
# Compute percentages
data$fraction <- data$count / sum(data$count)

# Compute the cumulative percentages (top of each rectangle)
data$ymax <- cumsum(data$fraction)

# Compute the bottom of each rectangle
data$ymin <- c(0, head(data$ymax, n=-1))

# Compute label position
data$labelPosition <- (data$ymax + data$ymin) / 2

# Compute a good label
data$label <- paste0(data$category, "\n value: ", data$count)

# Make the plot
ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=category)) +
  geom_rect() +
 # geom_text( x=1, aes(y=labelPosition, label=label, color=category), size=4) + # x here controls label position (inner / outer)
  scale_fill_brewer(palette = "Set2") + theme_minimal() +
  scale_color_brewer(palette = "Set2") +
  coord_polar(theta="y") +
  xlim(c(-1, 4)) +
  theme_void() + 
  labs(fill = "Tipo de funcionário")
  #theme(legend.position = "none")
```
Temos **1339** servidores, **98** membros e **107** pensionistas.

### Gastos com 'outros' são maiores que os de salários em alguns meses
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
# Stacked barchart para o trt13
bar_chart_trt_2019 <- dados_filtrados %>%
  filter(aid == "trt13" & year == 2018) %>% 
  gather(key="type", value = "value", wage, perks_total, others_total ) %>% 
  select(name, role, value, type, month) %>% 
  group_by(month, type) %>% 
  summarise(sum = sum(value))


bar_chart_trt_2019 %>%
    ggplot(aes(fill=type, y=sum, x=as.factor(month))) +
    geom_bar(position="stack", stat="identity") +
    scale_fill_brewer(palette = "Set2") + theme_minimal() +
    labs(y = "Valor total", x = "Mês", fill = "Classificação", title = "Distribuições das remunerações do TRT13 em 2018" ) +
    scale_y_continuous(labels = scales::comma)

```
Nos meses de janeiro e dezembro o gastos com 'outros' são maiores ou quase iguais aos de salários. 


### O Salário médio de um membro é o dobro do salário médio de um servidor
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
#Distribuição dos salários
dados_filtrados %>%
  filter(year == 2019 & month == 10  & aid == "trt13") %>%
  ggplot(aes(x=type, y=income_total, color=type)) +
  geom_violin() +
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  ggbeeswarm::geom_beeswarm(shape=16, alpha= 0.5,position=position_jitter(0.2)) + labs(x="",color= "Tipo  de funcionário", y = "Remuneração",       title = "Distribuição das remunerações do TRT13 em Outubro de 2019") 
```
O salário mediano em 2019 para um sevidor foi de **18.221,00 R\$**. Já para membros foi de **43.425,00 R\$**.


### A maior remuneração da história do TRT13 
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
dados_filtrados %>% 
  filter(aid == "trt13" & year == 2019 & month == 5) %>% 
  ggplot(aes(x=" Maio", y=income_total, color = aid )) +
  ggbeeswarm::geom_quasirandom(alpha=0.6) + 
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") + theme(legend.position = "none") + labs(x ="", y = "Remunerção Total") + scale_y_continuous(labels =        scales::comma) + 
  stat_summary(fun.y = max, colour = "darkorange", geom = "point", size = 4)
```
Em maio de 2019 um Analista Judiciário recebeu um total de de **370.603,00 R\$**

### Distribuição das remunerações no ano de 2019

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
dados_filtrados %>% 
  filter(aid == "trt13", year == 2019) %>% 
  ggplot(aes(x = income_total/1000, y = month, color = "trt13")) +  
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  geom_point(shape = 124, size = 6, alpha=0.3) + scale_y_continuous(breaks=seq(1, 11, by = 1)) + scale_x_continuous(labels = scales::comma, trans   = "log",breaks=c(0, 10, 70, 350)) + theme(legend.position = "none") + labs(x = "Valor da remuneração (em milhares R$)", y = "Mês", title = "Distribuição das remuneração em 2019") + 
  geom_point(aes(x = 18.5), size = 4, color = "#111111", shape = 124) +
   annotate("text", label = "Remuneração mediana de 2019", x = 47, y = 11.6, color = "#111111") 
```

### Os Juizes tem as melhores remunerações, seguidos pelos Análistas Judiciários. 

Os Juízes do TRT13 são os que apresentam as melhores remunerações no TRT13. Em segundo lugar temos os Analistas Judiciários. Em Terceiro os Técnico Judiciários. As categorias Sem Vínculo e Auxiliar Judiciário são minoria no TRT13 e apresentam as menores remunerações.

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
library(stringr)

dados_normalized_role <- dados_filtrados %>% 
  mutate( normalized_role =
    case_when(
      str_detect(str_to_lower(role), "analista judiciário") | str_detect(str_to_lower(role), "analista judiciario") | str_detect(str_to_lower(role), "analisa judiciário") ~ "Analista Judiciário",
      str_detect(str_to_lower(role), "inativo") ~ "Inativo",
      str_detect(str_to_lower(role), "juiz") ~ "Juiz", 
      str_detect(str_to_lower(role), "requisitado") ~ "Requisitado",
      str_detect(str_to_lower(role), "sem vínculo") ~ "Sem Vínculo",
      str_detect(str_to_lower(role), "tecnico judiciario") | str_detect(str_to_lower(role), "técnico judiciario") | str_detect(str_to_lower(role), "tecnico judiciário") | str_detect(str_to_lower(role), "técnico judiciário") ~ "Técnico Judiciário",
      str_detect(str_to_lower(role), "auxiliar judiciário")  ~ "Auxiliar Judiciário"
    )
  )

dados_normalized_role  %>% 
  filter(year == 2019 & month == 10  & aid == "trt13") %>%
  ggplot(aes(x=normalized_role, y=income_total, color=normalized_role)) +
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  ggbeeswarm::geom_quasirandom(shape=16, alpha= 0.5,position=position_jitter(0.3)) + labs(x="",color= "Tipo  de funcionário", y = "Remuneração",       title = "Remunerações de acordo com os cargos em Out de 2019 no TRT13") + 
  coord_flip() + 
  stat_summary(fun.y = median, colour = "#F25E4B", geom = "point", size = 1)
  
```

## TRE

O TRE atualmente tem um total de 801 funcionários. A remuneração mediana no ano de 2019 foi de 20.920,00 R\$. Enquanto a máxima foi de 50.360,00 R$ e o mínimo de 3.827,00 R\$.
No ano de 2018 tivemos uma remuneração mediana de 22.900,00 R\$. Enquanto a máxima é de 66.290,00 R\$ e o mínimo de 8.780,00 R$.

### Gastos com 'outros' são maiores que os de salários em alguns meses
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
# Stacked barchart para o TRE
bar_chart_tre_2019 <- dados_filtrados %>%
  filter(aid == "trepb" & year == 2018) %>% 
  gather(key="type", value = "value", wage, perks_total, others_total ) %>% 
  select(name, role, value, type, month) %>% 
  group_by(month, type) %>% 
  summarise(sum = sum(value))

bar_chart_tre_2019 %>%
    ggplot(aes(fill=type, y=sum, x=as.factor(month))) +
    geom_bar(position="stack", stat="identity") +
    scale_fill_brewer(palette = "Set2") + theme_minimal() +
    labs(y = "Valor total", x = "Mês", fill = "Classificação", title = "Distribuições das remunerações do TRE em 2018" ) +
    scale_y_continuous(labels = scales::comma)
```
Nos meses de janeiro, novembro e dezembro o gastos com 'outros' são maiores ou quase iguais aos de salários.

```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
#Distribuição dos salários
dados_filtrados %>%
  filter(aid == "trepb" & month == 1 & year == 2019) %>%
  ggplot(aes(x=aid, y=income_total, color = aid)) +
  geom_violin() +
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  ggbeeswarm::geom_beeswarm(shape=10, alpha= 0.5,position=position_jitter(0.5)) + theme(legend.position = "none") + labs(x="", y = "Remuneração",   title = "Distribuição das remunerações do TRE em Janeiro de 2019")
  
```
 
### Analistas Judiciários ganham em média 8.000,00 R$ a mais que Técnicos Judiciários 

O cargo de Analista Judiciário recebe em média **23.401,00 R\$**. Enquanto o Técnico Judiciário tem uma remunerção média de **15.761,00 R\$**.
 
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
library(stringr)

dados_normalized_role  %>% 
  filter(year == 2019 & month == 10  & aid == "trepb") %>%
  ggplot(aes(x=normalized_role, y=income_total, color=normalized_role)) +
  theme_minimal() + 
  scale_color_brewer(palette = "Set2") +
  ggbeeswarm::geom_quasirandom(shape=16, alpha= 0.5,position=position_jitter(0.3)) + labs(x="",color= "Tipo  de funcionário", y = "Remuneração",       title = "Remunerações de acordo com os cargos em Out de 2019 no TREPB") + 
  coord_flip() + 
  stat_summary(fun.y = median, colour = "#F25E4B", geom = "point", size = 1)
```
 
 
```{r echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE, paged.print = FALSE}
## JUNK CODE:
# resumo_tre_2019 <- dados_filtrados %>% 
#   filter(year == 2019) %>% 
#   filter(aid == "trepb") %>% 
#   pull(income_total) %>% 
#   summary()
# 
# resumo_tre_2018 <- dados_filtrados %>% 
#   filter(year == 2018) %>% 
#   filter(aid == "trepb") %>% 
#   pull(income_total) %>% 
#   summary()
# 
# dados_filtrados %>% 
#   filter(aid == "trepb") %>% 
#   filter(year == 2019) %>% 
#   ggplot(aes(income_total)) + 
#   theme(axis.text.x = element_text(angle = -60)) +
#   geom_histogram(binwidth=5000) + 
#   labs(y = "Total de funcionários", x = "Remuneração Total") + 
#   facet_wrap(~month)
# 
# dados_filtrados %>% 
#   filter(aid == "trt13") %>% 
#   filter(year == 2019) %>% 
#   ggplot(aes(income_total)) + 
#   theme(axis.text.x = element_text(angle = -60)) +
#   geom_histogram(binwidth=5000) + 
#   labs(y = "Total de funcionários", x = "Remuneração Total") + 
#   facet_wrap(~month)
# 
# 
# resumo_trt13_2019 <- dados_filtrados %>% 
#   filter(year == 2019) %>% 
#   filter(aid == "trt13") %>% 
#   pull(income_total) %>% 
#   summary()
# 
# resumo_trt13_2018 <- dados_filtrados %>% 
#   filter(year == 2018) %>% 
#   filter(aid == "trt13") %>% 
#   pull(income_total) %>% 
#   summary()
# 
# ala <- dados_filtrados %>%
#   filter(aid == "trepb") %>% 
#   filter(year == 2019) %>% 
#   gather(key="type", value = "value", wage, perks_total, others_total ) %>% 
#   select(name, role, value, type, month)
# 
# 
#   agrupado <- ala %>% group_by(month, type) %>% 
#     summarise(sum = sum(value))
# 
# a <- data.frame(type = c("w","p","t","w","p","t"), mes = c(1,1,1,2,2,2), valor = c(10,20,30,15,40,30))
# 
# agrupado %>%  ggplot(aes(fill=type, y=sum, x=as.factor(month))) + 
#     geom_bar(position="stack", stat="identity") + 
#     scale_fill_manual(values = c("others_total" = "orange","perks_total" = "red", "wage"= "blue"))
# 
# #wage, perks_total e others_total
# 
# dados_filtrados %>%
#   filter(aid == "trt13", month == 1) %>%
#   ggplot(aes(x=aid, y=income_total)) + 
#   geom_violin() + 
#   ggbeeswarm::geom_beeswarm(shape=16, alpha= 0.5,position=position_jitter(0.2))

## Plotar quantidade de servidores, pensionista e magistrados : 
# dados %>% 
#   filter(year == 2019) %>% 
#   filter(month == 10) %>% 
#   group_by(aid, type) %>%
#   count() %>% 
#   ggplot(aes(x=aid, y=n, fill=type)) +
#   geom_bar(stat="identity")+theme_minimal() + scale_fill_brewer(palette = "Set2") + xlab("Órgão") + ylab("Total de funcionários") + labs(fill = "Tribunal") +
#   scale_fill_brewer(palette = "Set2") 

# dados_filtrados %>% 
#   filter(aid == "trt13", year == 2019) %>% 
#   ggplot(aes(x = income_total/1000, y = month, color = "trt13")) +  
#   theme_minimal() + 
#   scale_color_brewer(palette = "Set2") +
#   geom_point(shape = 124, size = 6, alpha=0.3) + scale_y_continuous(breaks=seq(1, 11, by = 1)) + scale_x_continuous(labels = scales::comma, trans   = "log",breaks=c(0, 10, 70, 350)) + theme(legend.position = "none") + labs(x = "Valor da remuneração (em milhares R$)", y = "Mês", title = "Distribuição das remuneração em 2019") + 
#   geom_point(aes(x = 24.3), size = 4, color = "#111111", shape = 124) +
#    annotate("text", label = "Remunerção mediana de 2019", x = 60, y = 11.3, color = "#111111") 
# 
# dados_filtrados %>% 
#   filter(aid == "trt13", year == 2019) %>% 
#   ggplot(aes(x = income_total/1000, y = month, color = "trt13")) +  
#   theme_minimal() + 
#   scale_color_brewer(palette = "Set2") +
#   geom_point(shape = 124, size = 6, alpha=0.3) + scale_y_continuous(breaks=seq(1, 11, by = 1)) + scale_x_continuous(labels = scales::comma, trans   = "log",breaks=c(0, 10, 70, 350)) + theme(legend.position = "none") + labs(x = "Valor da remuneração (em milhares R$)", y = "Mês", title = "Distribuição das remuneração em 2019") 
# 
# dados_filtrados %>% 
#   filter(aid == "trt13", year == 2019) %>% 
#   ggplot(aes(x = income_total, y = month, color = "trt13")) +  
#   theme_minimal() + 
#   scale_color_brewer(palette = "Set2") +
#   geom_point(shape = 124, size = 5, alpha=0.3) + scale_y_continuous(breaks=seq(1, 11, by = 1)) + scale_x_continuous(labels = scales::comma, trans = "log",breaks=c(0, 10000, 20000, 35000, 50000, 80000, 150000, 250000)) + theme(legend.position = "none") + labs(x = "Valor da remuneração", y = "Mês")

# library(ggwordcloud)
# 
# ala <- dados_filtrados %>% 
#   filter(year == 2019, aid == "trt13", month == 10) %>% 
#   group_by(workplace) %>% 
#   count()
# 
# ala %>% 
#   ggplot(aes(label = workplace, size = n)) +
#   geom_text_wordcloud_area(area_corr_power = 1 ) +
#   scale_size_area(max_size = 25) +
#   theme_minimal()

```


# Dúvidas
 - Os pensionistas só apararecem se eu tirar o filtro de incometotal > 0 devo deixar esse filtro ou não?
 - Usar o income_total ou fazendo o calculo dos descontos?
 - Barras ou donut ?



<div class="logo">![](https://avatars2.githubusercontent.com/u/17051677?s=200&v=4)</div>
